# 基础首要

### 构建聚合工程

```
service -> mapper -> pojo -> common
```

### 数据库建模工具

PDman（CHINER）

### 什么是HikariCP？HikariCP介绍

##### 什么是连接池

数据库连接池负责分配、管理和释放数据库的连接。

- 数据库连接复用：重复使用现有的数据库长连接，可以避免连接频繁建立、关闭的开销。
- 统一的连接管理：释放空闲时间超过最大空闲时间的数据库连接，避免因为没有释放数据库连接而引起的数据库连接泄漏。

##### 什么是HikariCP

HikariCP 是一个高性能的 JDBC 连接池组件，号称性能最好的后起之秀，是一个基于BoneCP做了不少的改进和优化的高性能JDBC连接池。

##### 重要参数

maximum-pool-size   池中最大连接数（包括空闲和正在使用的连接）
minimum-idle   池中最小空闲连接数量。默认值10
pool-name   连接池的名字
auto-commit   是否自动提交池中返回的连接。默认值为true。
idle-timeout    空闲时间。仅在minimum-idle小于maximum-poop-size的时候才会起作用。默认值10分钟。
max-lifetime   连接池中连接的最大生命周期。当连接一致处于闲置状态时，数据库可能会主动断开连接。
connection-timeout   连接超时时间。默认值为30s，可以接收的最小超时时间为250ms。但是连接池请求也可以自定义超时时间

```
hikari:
      connection-timeout: 30000       # 等待连接池分配连接的最大时长（毫秒），超过这个时长还没可用的连接则发生SQLException， 默认:30秒
      minimum-idle: 5                 # 最小连接数
      maximum-pool-size: 20           # 最大连接数
      auto-commit: true               # 自动提交
      idle-timeout: 600000            # 连接超时的最大时长（毫秒），超时则被释放（retired），默认:10分钟
      pool-name: DateSourceHikariCP     # 连接池名字
      max-lifetime: 1800000           # 连接的生命时长（毫秒），超时而且没被使用则被释放（retired），默认:30分钟 1800000ms
      connection-test-query: SELECT 1
```

### 事务传播 - Propagation

**REQUIRED**: 使用当前的事务，如果当前没有事务，则自己新建一个事务，子方法是必须运行在一个事务中的；
                      如果当前存在事务，则加入这个事务，成为一个整体。
                      举例：领导没饭吃，我有钱，我会自己买了自己吃；领导有的吃，会分给你一起吃。
**SUPPORTS:** 如果当前有事务，则使用事务；如果当前没有事务，则不使用事务。
                      举例：领导没饭吃，我也没饭吃；领导有饭吃，我也有饭吃。
**MANDATORY:** 该传播属性强制必须存在一个事务，如果不存在，则抛出异常
                           举例：领导必须管饭，不管饭没饭吃，我就不乐意了，就不干了（抛出异常）
**REQUIRES_NEW**:如果当前有事务，则挂起该事务，并且自己创建一个新的事务给自己使用；
                              如果当前没有事务，则同 REQUIRED
                              举例：领导有饭吃，我偏不要，我自己买了自己吃
**NOT_SUPPORTED:** 如果当前有事务，则把事务挂起，自己不适用事务去运行数据库操作
                                   举例：领导有饭吃，分一点给你，我太忙了，放一边，我不吃
**NEVER:** 如果当前有事务存在，则抛出异常
               举例：领导有饭给你吃，我不想吃，我热爱工作，我抛出异常
**NESTED:** 如果当前有事务，则开启子事务（嵌套事务），嵌套事务是独立提交或者回滚；
                 如果当前没有事务，则同 REQUIRED。
                 但是如果主事务提交，则会携带子事务一起提交。
                 如果主事务回滚，则子事务会一起回滚。相反，子事务异常，则父事务可以回滚或不回滚。
                 举例：领导决策不对，老板怪罪，领导带着小弟一同受罪。小弟出了差错，领导可以推卸责任。

### 用户注册

##### 判断用户名存在

采用Mybatis中Example的案例

```
        Example userExample = new Example(Users.class);

        Example.Criteria userCriteria = userExample.createCriteria();

        userCriteria.andEqualTo("username", username);

        Users result = usersMapper.selectOneByExample(userExample);

        return result == null ? false : true;
```

##### 自定义响应数据结构

前端接受此类数据（json object)后，可自行根据业务去实现相关功能
 * 				200：表示成功
 * 				500：表示错误，错误信息在msg字段中
 * 				501： bean验证错误，不管多少个错误都以map形式返回
 * 				502：拦截器拦截到用户token出错
 * 				555：异常抛出信息
 * 				556: 用户qq校验异常

![1631757270868](C:\Users\hspcadmin\AppData\Roaming\Typora\typora-user-images\1631757270868.png)

##### 创建用户

前端传用户名，密码及确认密码传到后端参数，称为**BO**

创建用户要考虑几点：

判断用户名是否为空

判断用户名是否存在

判断密码是否低于六位

手机号格式是否正确

两次密码是否一致



**tips:密码设置以后可以加一个盐值。**



### 文档 Swagger

减少编写过多的文档，只需要通过代码就可以生成api提供给前端人员对接，非常方便

配置swagger

```
public class Swagger2 {
    //配置swagger核心配置docket

    public Docket createRestApi(){
        return new Docket(DocumentationType.SWAGGER_2)   //指定api类型为swagger2
                .apiInfo(apiInfo())               //用于指定api文档汇总信息
                .select()
                .apis(RequestHandlerSelectors.basePackage("com.imooc.controller"))  //指定controller包
                .paths(PathSelectors.any())              //所有controller
                .build();
    }
    private ApiInfo apiInfo(){
        return new ApiInfoBuilder()
                .title("天天吃货 平台接口api")     // 文档标题页
                .contact(new Contact("imooc",
                        "https://www.imooc.com",
                        "1959077155@qq.com"))  //联系人信息
                .description("为天天吃货提供的api文档")  // 详细信息
                .version("1.0.0")//文档版本号
                .termsOfServiceUrl("https://www.imooc.com")   //网站地址
                .build();
    }
}
```

